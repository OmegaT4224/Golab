<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quantum Blockchain Test</title>
    <style>
        body { 
            margin: 0; 
            padding: 20px;
            font-family: Arial, sans-serif; 
            background: #0f0f0f;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .status {
            background: rgba(79, 195, 247, 0.1);
            border: 1px solid #4fc3f7;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .blockchain-info {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
        }
        .block {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid #4caf50;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            font-family: monospace;
            font-size: 12px;
        }
        button {
            background: #4fc3f7;
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #29b6f6;
        }
        input {
            padding: 8px;
            border: 1px solid #4fc3f7;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Quantum Blockchain Lab - Test Interface</h1>
        
        <div class="status" id="status">
            Initializing blockchain...
        </div>

        <div class="blockchain-info">
            <h2>Blockchain Statistics</h2>
            <div id="stats">Loading...</div>
        </div>

        <div class="blockchain-info">
            <h2>Add New Block</h2>
            <input type="text" id="blockData" placeholder="Enter transaction data..." />
            <button onclick="addBlock()">Mine Block</button>
            <button onclick="runDemo()">Run Demo</button>
            <button onclick="validateChain()">Validate Chain</button>
        </div>

        <div class="blockchain-info">
            <h2>Blockchain Visualization</h2>
            <div id="blocks">No blocks yet...</div>
        </div>
    </div>

    <!-- Include blockchain modules -->
    <script src="blockchain.js"></script>

    <script>
        let blockchain;
        let blockCount = 0;

        function initializeBlockchain() {
            try {
                console.log('Initializing blockchain...');
                blockchain = new Blockchain();
                
                // Add initial demo block
                blockchain.addBlock({
                    type: 'genesis_transaction',
                    data: 'Initial quantum coin distribution',
                    timestamp: Date.now()
                });

                updateStatus('‚úÖ Quantum blockchain initialized successfully!');
                updateDisplay();
                
            } catch (error) {
                console.error('Blockchain initialization error:', error);
                updateStatus('‚ùå Error: ' + error.message);
            }
        }

        function updateStatus(message) {
            document.getElementById('status').innerHTML = message;
        }

        function updateDisplay() {
            if (!blockchain) return;

            const stats = blockchain.getStats();
            document.getElementById('stats').innerHTML = `
                <strong>Total Blocks:</strong> ${stats.totalBlocks}<br>
                <strong>Difficulty:</strong> ${stats.difficulty}<br>
                <strong>Chain Valid:</strong> ${stats.isValid ? '‚úÖ Yes' : '‚ùå No'}<br>
                <strong>Last Block Time:</strong> ${new Date(stats.lastBlockTime).toLocaleString()}
            `;

            // Display blocks
            const blocksDiv = document.getElementById('blocks');
            blocksDiv.innerHTML = '';
            
            blockchain.chain.forEach((block, index) => {
                const blockDiv = document.createElement('div');
                blockDiv.className = 'block';
                blockDiv.innerHTML = `
                    <strong>Block #${block.index}</strong><br>
                    Hash: ${block.hash}<br>
                    Previous: ${block.previousHash}<br>
                    Data: ${JSON.stringify(block.data)}<br>
                    Nonce: ${block.nonce}<br>
                    Quantum Signature: ${block.quantumSignature.substring(0, 50)}...
                `;
                blocksDiv.appendChild(blockDiv);
            });
        }

        function addBlock() {
            const dataInput = document.getElementById('blockData');
            const data = dataInput.value.trim();
            
            if (!data) {
                alert('Please enter block data');
                return;
            }

            if (!blockchain) {
                alert('Blockchain not initialized');
                return;
            }

            updateStatus('‚õèÔ∏è Mining block...');
            
            // Use setTimeout to prevent UI blocking
            setTimeout(() => {
                try {
                    blockchain.addBlock({
                        type: 'transaction',
                        data: data,
                        timestamp: Date.now()
                    });
                    
                    dataInput.value = '';
                    updateStatus('‚úÖ Block mined successfully!');
                    updateDisplay();
                } catch (error) {
                    updateStatus('‚ùå Error mining block: ' + error.message);
                }
            }, 100);
        }

        function runDemo() {
            if (!blockchain) {
                alert('Blockchain not initialized');
                return;
            }

            const demoData = [
                'Alice sends 10 QTC to Bob',
                'Bob sends 5 QTC to Charlie', 
                'Charlie sends 15 QTC to Dave',
                'Dave sends 8 QTC to Alice'
            ];

            updateStatus('üé¨ Running demo transactions...');

            let index = 0;
            function addDemoBlock() {
                if (index < demoData.length) {
                    blockchain.addBlock({
                        type: 'demo-transaction',
                        data: demoData[index],
                        timestamp: Date.now()
                    });
                    
                    updateDisplay();
                    index++;
                    setTimeout(addDemoBlock, 1000);
                } else {
                    updateStatus('‚úÖ Demo transactions completed!');
                }
            }
            
            addDemoBlock();
        }

        function validateChain() {
            if (!blockchain) {
                alert('Blockchain not initialized');
                return;
            }

            const isValid = blockchain.isChainValid();
            updateStatus(isValid ? '‚úÖ Blockchain is valid!' : '‚ùå Blockchain is invalid!');
            updateDisplay();
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initializeBlockchain, 500);
        });

        // Handle Enter key in input
        document.getElementById('blockData').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addBlock();
            }
        });
    </script>
</body>
</html>